{% extends 'base.html' %}

{% block list %}
  {% include 'layout/sidebar.html' %}
{% endblock %}

{% block nav %}
	{% include 'layout/nav.html' %}
{% endblock %}

{% block content %}
{% if not error_msg %}

  <div class="container-fluid">
    <div class="profil clearfix">
    	{% if group and curUser == group.admin %}
    	<a href="{% url 'twittur:group_settings' groupshort=group.short %}" class="profilEdit" title="Gruppe bearbeiten">
      	<span class="glyphicon glyphicon-cog"></span>
      </a>
      {% elif active_page == 'profile' and curUser = user %}
    	<a href="{% url 'twittur:settings' %}" class="profilEdit" title="Profil bearbeiten">
      	<span class="glyphicon glyphicon-cog"></span>
      </a>
      {% endif %}
      <div class="col-xs-12 col-sm-4 text-center">
      	{% if group %}
          <img src="{{ group.picture.url }}" class="profilbild-s img-thumbnail"/>
        {% else %}
          <img src="{{ curUserProfile.picture.url }}" class="profilbild-s img-thumbnail"/>
        {% endif %}
      </div>
      <div class="col-xs-12 col-sm-8 clearfix">
        <div class="profilMeta">
          <h3 class="profilAuthor">
          	{% if group %}{{ group.name }}{% else %}{{ curUser.first_name }} {{ curUser.last_name }}{% endif %}
          </h3>
          <h5 class="profilNick" data-hint="{% if group %}{{ group.short }}{% else %}{{ curUser.username }}{% endif %}">
          	{% if group %}&{{ group.short }}{% else %}@{{ curUser.username }}{% endif %}
          </h5>          
          <div class="profilAcaDis" title="Studiengang">
          	{% if group %}
              <span class="glyphicon glyphicon-user" aria-hidden="true"></span>
              {{ group.admin.first_name }} {{ group.admin.last_name }} (@<a href="{% url 'twittur:profile' user=group.admin %}">{{ group.admin.username }}</a>)
            {% else %}
              <span class="glyphicon glyphicon-education" aria-hidden="true"></span>             
              {{ curUserProfile.academicDiscipline }} 
            {% endif %}
          </div>
          {% if group %}
          <div class="groupMember" title="Mitglieder">
            <form action="{% url 'twittur:group' groupshort=group.short %}" method="get">
            	<input name="member" type="hidden" value="true" />
              <strong><span class="glyphicon glyphicon-user" aria-hidden="true"></span> 
            	<input class="showMembList" type="submit" value="{{ member_list|length }} {% if member_list|length == 1 %}Mitglied{% else %}Mitglieder{% endif %}" /></strong>
            </form>
          </div>          
          {% else %}
          <div class="profilLocation" title="Wohnort">
          	<span class="glyphicon glyphicon-map-marker" aria-hidden="true"></span> 
            {{ curUserProfile.location }}
          </div>
          {% endif %}
          <div class="profilJoined" title="{% if group %}erstellt am{% else %}registriert seit{% endif %}">
          	<span class="glyphicon glyphicon-time" aria-hidden="true"></span> 
            {% if group %}{{ group.date }}{% else %}{{ curUser.date_joined|date:"j. F Y, \u\m H:i \U\h\r" }}{% endif %}
          </div>
          {% if group %}
          <div class="profilDesc" title="Beschreibung der Gruppe">
          	<span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> 
            {{ group.desc }}
          </div>
          {% endif %}
          <!--{% if request.user != curUser %}
          <div class="profilButton">
            <form action="{% url 'twittur:profile' user=curUser %}" method="GET">
              <button class="btn btn-primary" id="follow" name="follow" type="submit" value=""> {{ follow_text|safe }} </button>
            </form>
          </div>
          {% endif %}
          <div class="profilLink"><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span> Nachricht senden</div>
          <div class="profilLink"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Nachfolgen</div>
          --> 
        </div>
      </div>
    </div>
    {% if request.user != curUser and not group %}
    <form action="{% url 'twittur:profile' user=curUser %}" method="GET" >
    	<input name="follow" type="hidden" value="follow" />
      <button class="col-xs-6 text-center btn btn-default profileButton" id="id_follow" type="submit">
        <strong>{{ follow_text|safe }}</strong>
      </button>
    </form>
    <button class="col-xs-6 text-center btn btn-default profileButton postToUser" data-hint="{{ curUser }}" data-toggle="modal" data-target="#newMessage" id="postToUser" title="{{ curUser|upper }} schreiben" type="button">
      <strong><span class="glyphicon glyphicon-edit"></span> {{ curUser|upper }} schreiben</strong>
    </button>
    {% endif %}
    {% if group %}
    	{% if not group.password and not is_member or is_member %}
        <form action="{% url 'twittur:djlgroup' groupshort=group.short %}" method="POST" >
            {% csrf_token %}
          <input name="delete_join_group" type="hidden" value="delete_group" />
          <button class="col-xs-6 text-center btn btn-default profileButton" id="id_join_group" type="submit">
            <strong>{{ button_text|safe }}</strong>
          </button>
        </form>
      {% else %}
        <button class="col-xs-6 text-center btn btn-default profileButton postToGroup" data-hint="{{ group.short }}" data-toggle="modal" data-target="#enterPWforGroup" id="joinGroup" title="Gruppe beitreten" type="button">
          <strong><span class="glyphicon glyphicon-edit"></span> {{ group.short|upper }} beitreten</strong>
        </button>
        <div class="modal fade" id="enterPWforGroup" tabindex="-1" role="dialog" aria-labelledby="enterPWforGroupLabel" aria-hidden="true">
          <div class="modal-dialog modal-sm">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Passwort f&uuml;r {{ group.short|upper }} eingeben!</h4>
              </div>
              <form action="{% url 'twittur:djlgroup' groupshort=group.short %}" method="POST">
              {% csrf_token %}
              <div class="modal-body">
                <input class="form-control" name="password" type="password" />
              </div>
              <div class="modal-footer">
                  <input name="delete_join_group" type="hidden" value="true" />
                  <input name="joinWithPassword" type="hidden" value="true" />
                  <button type="button" class="btn btn-default" data-dismiss="modal">Ok, doch nicht.</button>
                  <button type="submit" class="btn btn-primary">Beitreten</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      {% endif %}
    
    <button class="col-xs-6 text-center btn btn-default profileButton postToGroup" data-hint="{{ group.short }}" data-toggle="modal" data-target="#newMessage" id="postToGroup" title="an {{ group.short|upper }} schreiben" type="button">
      <strong><span class="glyphicon glyphicon-edit"></span> an {{ group.short|upper }} schreiben</strong>
    </button>
    {% endif %}
  </div>
  <br />
  {% if show_member %}
  <div class="profileMessages container-fluid">
  	<a href="{% url 'twittur:group' groupshort=group.short %}">&laquo; Nachrichten anzeigen</a><br />
    <br />
  	<ul class="post memberList">
  	{% for member in member_list %}
    	<li class="clearfix">{{ member.first_name }} {{ member.last_name }} (@<a href="{% url 'twittur:profile' user=member.username %}">{{ member.username }}</a>) 
      										 {% if member == group.admin %}<span class="pull-right"> [admin]</span>{% endif %}
    {% endfor %}
    </ul>
  </div>
  {% endif %}
  {% if show_favs %}
  <div class="profileMessages container-fluid">
  	<a href="{% url 'twittur:profile' user=user %}">&laquo; Nachrichten anzeigen</a><br />
    <br />
  	<ul class="post memberList">
  	{% for fav in follow_list %}
    	<li class="clearfix">{{ fav.first_name }} {{ fav.last_name }} (@<a href="{% url 'twittur:profile' user=fav.username %}">{{ fav.username }}</a>)
    {% endfor %}
    </ul>
  </div>
  {% endif %}
  <div class="profileMessages container-fluid{% if show_member or show_favs %} hidden{% endif %}">
    {% if has_msg %}
      {% for message, dbmessage, comments, count in message_list %}
        {% include "message_box.html" with message=message dbmessage=dbmessage comments=comments comCount=count page=active_page user=user  %}
      {% endfor %}
      </div>
      <div class="text-center{% if show_member or show_favs or list_end %} hidden{% endif %}">
      	{% if group %}
          <button class="load_more btn btn-default" data-hint="{% url 'twittur:group' groupshort=group.short %}" title="Mehr Beitr&auml;ge laden">
            <span class="glyphicon glyphicon-refresh"></span>
          </button>
        {% else %}
          <button class="load_more btn btn-default" data-hint="{% url 'twittur:profile' user=curUser %}" title="Mehr Beitr&auml;ge laden">
            <span class="glyphicon glyphicon-refresh"></span>
          </button>
        {% endif %}
    {% else %}
      <div class="text-center"><em>Keine Nachrichten zum Anzeigen gefunden!</em></div>
    {% endif %}
  </div>
{% endif %}
{% endblock %}