{% extends 'base.html' %}
{% load staticfiles %}

{% block list %}	
  {% include 'layout/sidebar.html' %}
{% endblock %}

{% block nav %}
	{% include 'layout/nav.html' %}
{% endblock %}

{% block content %}
  <form action="{% url 'twittur:group_settings' groupshort=group.short %}" method="post" enctype="multipart/form-data">
  {% csrf_token %}
    <input name="delete" type="hidden" value="false" />                
    <div class="post" id="bild">        
        <h4>Gruppenbild ausw&auml;hlen</h4>
        
        <div class="col-xs-12 form-group">
          <div class="col-xs-12 text-center profilePictures">
            {% if group.picture.url %}
            <a href="{{ group.picture.url }}" target="_blank">
              <img src="{{ group.picture.url }}" class="profilbild-l img-thumbnail">
            </a>
            {% endif %}
            <p class="help-block">{{ gpeForm.picture.help_text | safe }}</p>
          </div>
          <div id="profBildUpdate">
            <span><strong>Aktuelles Gruppenbild</strong>: </span>
            {{ gpeForm.picture }} 
          </div>                
        </div>            
    </div>
    
    <div class="post" id="gruppe">    
      <h4>Gruppendaten</h4>
    
        <div class="col-xs-12 form-group">
            <label class="control-label" for="id_name">Name</label>
            {{ gpeForm.name }}
        </div>
        
        <div class="col-xs-12 form-group">
            <label class="control-label" for="id_short">Abk&uuml;rzung</label>
            {{ gpeForm.short }}
            <p class="help-block">Die Gruppen-Abk&uuml;rzung kann nicht ver&auml;ndert werden.</p>
        </div>
        
        <div class="col-xs-12 form-group">
          <label class="control-label" for="id_desc">Beschreibung</label>
          {{ gpeForm.desc }}
        </div>
        
        <div class="col-xs-12 col-sm-6 form-group">
          <label class="control-label" for="id_password">Passwort</label>
            {{ gpeForm.password }}
          <p class="help-block">
          	Das Gruppenpasswort darf keine Leerzeichen enthalten und muss mit der Best&auml;tigung &uuml;bereinstimmen!
          </p>
        </div>    
        <div class="col-xs-12 col-sm-6 form-group pull-right">
          <label class="control-label" for="id_ack_password">Passwort best&auml;tigen</label>
          {{ gpeForm.ack_password }}
        </div>
        {% if group.password %}
        <div class="col-xs-12 form-group pull-right">          
          <input name="group_public" type="checkbox" />
          <label class="control-label" for="id_ack_password">Gruppe &ouml;ffentlich machen?</label>
        </div>
        {% endif %}
    </div> 
        
    <div class="post" id="member">      
      <div class="memberHead clearfix">
        <h4 class="pull-left">Mitglieder</h4> 
        <span class="glyphicon glyphicon-plus pull-right"></span>
      </div>
                
      <ul class="memberList clearfix hidden">
      {% for member in member_list %}
        <li class="clearfix">{{ member.first_name }} {{ member.last_name }} (@<a href="{% url 'twittur:profile' user=member.username %}">{{ member.username }}</a>) 
                             {% if member == group.admin %}
                                <span class="pull-right"> [admin]</span>
                             {% elif request.user == group.admin %}
                                <a class="btn-xs pull-right remUser" data-toggle="modal" data-target="#remUser{{ member.id }}Modal"
                                	 id="remUser{{ member.id }}Button" title="Mitglied entfernen">
                                  <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                                </a>
                                <a class="btn-xs pull-right promUser" data-toggle="modal" data-target="#promUser{{ member.id }}Modal" 
                                	 id="promUser{{ member.id }}Button" title="zum Admin machen">
                                  <span class="glyphicon glyphicon-king" aria-hidden="true"></span>
                                </a>                          		
                             {% endif %}
      {% endfor %}
      </ul>
    </div> 
          
    <div class="post" id="delete">      
      <h4>Gruppe vollst&auml;ndig l&ouml;schen</h4>
      
      <div class="col-xs-12 form-group text-center">
          <p class="help-block">
            &Uuml;ber diesen Button k&ouml;nnen Sie Ihre Gruppe vollst&auml;ndig von unserer Plattform entfernen. 
            Alle Mitglieder werden aus der Gruppe entfernt und alle Nachrichten der Gruppe vom System gel&ouml;scht.  
            Zur Best&auml;tigung der L&ouml;schung erhalten Sie eine E-Mail an Ihre uns bekannte E-Mail Adresse.
          </p>
          <button type="button" class="btn btn-primary text-center" data-toggle="modal" data-target="#delGrpModal" id="deleteButton">Gruppe l&ouml;schen</button>
      </div>        
    </div>
        
    <div class="col-xs-12 form-group text-center">
      <button type="submit" class="btn btn-primary" id="submitSettButton">Speichern</button>
      <button type="reset" class="btn btn-default" id="resetSettButton">Zur&uuml;cksetzen</button>
    </div>  
  </form>
  
  <div class="modal fade" id="delGrpModal" tabindex="-1" role="dialog" aria-labelledby="delGrpModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">Gruppe l&ouml;schen?</h4>
        </div>
        <div class="modal-body">
          Wollen Sie Ihre Gruppe wirklich l&ouml;schen?
        </div>
        <div class="modal-footer">
          <form action="{% url 'twittur:group_settings' groupshort=group.short %}" method="POST">
          {% csrf_token %}
            <input name="delete" type="hidden" value="true" />
            <button type="button" class="btn btn-default" data-dismiss="modal">Abbrechen</button>
            <button type="submit" class="btn btn-primary">Endg&uuml;ltig l&ouml;schen</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  
  <!-- modals to promote and delete member -->
  {% if request.user == group.admin and member_list %}
    {% for member in member_list %}    
      <div class="modal fade" id="remUser{{ member.id }}Modal" tabindex="-1" role="dialog" aria-labelledby="remUser{{ member.id }}ModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="myModalLabel"><em>{{ member.username }}</em> wirklich entfernen?</h4>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Abbrechen</button>
              <form action="{% url 'twittur:group_settings' groupshort=group.short %}" class="pull-right" method="POST">
              {% csrf_token %}
                <input type="hidden" name="group" value="{{ group.id }}">
                <input type="hidden" name="remUser" value="{{ member.id }}">
                <button type="submit" class="btn btn-primary">Benutzer entfernen</button>
              </form>
            </div>
          </div>
        </div>
      </div>   
      
      <div class="modal fade" id="promUser{{ member.id }}Modal" tabindex="-1" role="dialog" aria-labelledby="promUser{{ member.id }}ModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="myModalLabel"><em>{{ member.username }}</em> wirklich zum Admin machen?</h4>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Abbrechen</button>
              <form action="{% url 'twittur:group' groupshort=group.short %}" class="pull-right" method="POST">
              {% csrf_token %}
                <input type="hidden" name="group" value="{{ group.id }}">
                <input type="hidden" name="promUser" value="{{ member.id }}">
                <button type="submit" class="btn btn-primary">Benutzer bef&ouml;rdern</button>
              </form>
            </div>
          </div>
        </div>
      </div>  
    {% endfor %}
  {% endif %}

{% endblock %}